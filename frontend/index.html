<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>RobloxModss</title>
<style>
body {
  margin: 0;
  padding: 0;
  background-color: #2f2f2f;
  color: white;
  font-family: "Roboto", sans-serif;
  overflow: hidden;
  user-select: none;
  touch-action: none;
}

.center-info {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

h1 {
  font-size: 28px;
  margin: 10px 0;
}

.info {
  font-size: 18px;
  color: #ccc;
  margin: 5px 0;
}

#overlay {
  position: fixed;
  top:0; left:0; right:0; bottom:0;
  background: rgba(0,0,0,0.3);
  display: none;
  z-index: 99;
}

#modListContainer {
  position: fixed;
  bottom: 0;
  left:0; right:0;
  height: 0;
  background: #1e1e1e;
  border-top-left-radius: 20px;
  border-top-right-radius: 20px;
  overflow-y: auto;
  transition: height 0.3s ease;
  padding: 60px 15px 15px 15px;
  box-sizing: border-box;
  z-index: 100;
}

.mod-card {
  background: #2f2f2f;
  border-radius: 10px;
  padding: 10px 15px;
  margin-bottom: 10px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 16px;
  color: #fff;
}

.mod-card .status {
  padding: 2px 8px;
  border-radius: 5px;
  font-size: 14px;
  font-weight: bold;
}

.status.up {
  background-color: #28a745;
  color: white;
}

.status.outdated {
  background-color: #dc3545;
  color: white;
}

#dragHandle {
  position: fixed;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 120px;
  height: 30px;
  background: #3a3a3a;
  border-radius: 15px 15px 0 0;
  text-align: center;
  line-height: 30px;
  color: #bbb;
  font-weight: bold;
  font-size: 16px;
  z-index: 101;
  user-select: none;
  touch-action: none;
}
</style>
</head>
<body>

<div class="center-info">
  <h1 id="status">Проверка Roblox...</h1>
  <div class="info" id="version">Версия: —</div>
  <div class="info" id="modType">Модификация: —</div>
</div>

<div id="overlay"></div>

<div id="modListContainer"></div>
<div id="dragHandle">⬆️ Потяните вверх для модификаций</div>

<script>
const overlay = document.getElementById('overlay');
const modListContainer = document.getElementById('modListContainer');
const dragHandle = document.getElementById('dragHandle');
let startY = 0, startHeight = 0, dragging = false;
const maxHeight = window.innerHeight * 0.8;

// Drag
dragHandle.addEventListener('touchstart', e => {
  startY = e.touches[0].clientY;
  startHeight = parseFloat(getComputedStyle(modListContainer).height);
  dragging = true;
  modListContainer.style.transition = 'none';
  overlay.style.display = 'block';
});

dragHandle.addEventListener('touchmove', e => {
  if(!dragging) return;
  const diff = startY - e.touches[0].clientY;
  let newHeight = Math.min(Math.max(startHeight + diff, 0), maxHeight);
  modListContainer.style.height = newHeight + 'px';
  e.preventDefault();
}, {passive:false});

dragHandle.addEventListener('touchend', e => {
  if(!dragging) return;
  dragging = false;
  modListContainer.style.transition = 'height 0.3s ease';
  const h = parseFloat(modListContainer.style.height);
  if(h > maxHeight / 2) modListContainer.style.height = maxHeight + 'px';
  else {
    modListContainer.style.height = '0';
    overlay.style.display = 'none';
  }
});

// Закрытие по клику на overlay
overlay.addEventListener('click', () => {
  modListContainer.style.height = '0';
  overlay.style.display = 'none';
});

// Обновление статуса Roblox
function updateInfo(found, version, modType) {
  document.getElementById('status').textContent = found ? "✅ Roblox найден" : "❌ Roblox не найден";
  document.getElementById('version').textContent = "Версия: " + (version || "—");
  document.getElementById('modType').textContent = "Модификация: " + (modType || "—");
}

// Загрузка модификаций
function loadMods() {
  fetch('https://roblox-modss.vercel.app/backend/data.json')
    .then(res => res.json())
    .then(data => {
      modListContainer.innerHTML = '';
      data.forEach(mod => {
        const card = document.createElement('div');
        card.className = 'mod-card';
        card.innerHTML = `
          <span>${mod.name} (v${mod.version})</span>
          <span class="status ${mod.upToDate ? 'up' : 'outdated'}">
            ${mod.upToDate ? 'Обновлено' : 'Устарело'}
          </span>
        `;
        modListContainer.appendChild(card);
      });
    })
    .catch(err => console.error(err));
}

// AndroidBridge
async function initFromAndroid() {
  if(window.AndroidBridge) {
    let modType = '—', robloxVersion = '—', installed = false;
    try {
      modType = await AndroidBridge.getUserModType();
      robloxVersion = await AndroidBridge.getRobloxVersion();
      installed = await AndroidBridge.isRobloxInstalled();
    } catch(e) {}
    updateInfo(installed, robloxVersion, modType);
  }
  loadMods();
}

initFromAndroid();
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>RobloxModss</title>
<style>
  body {
    margin: 0;
    padding: 0;
    background-color: #2f2f2f;
    color: white;
    font-family: "Roboto", sans-serif;
    overflow: hidden;
    user-select: none;
    touch-action: none;
  }

  /* Центрируем статус */
  .center-info {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
  }

  h1 {
    font-size: 28px;
    margin: 10px 0;
  }

  .info {
    font-size: 18px;
    color: #ccc;
    margin: 5px 0;
  }

  /* Полупрозрачный фон для модального окна */
  #overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.3);
    display: none;
    z-index: 99;
  }

  /* Панель модификаций */
  #modListContainer {
    position: fixed;
    bottom: -80%;
    left: 0;
    width: 100%;
    height: 80%;
    background: #1e1e1e;
    border-top-left-radius: 20px;
    border-top-right-radius: 20px;
    overflow-y: auto;
    transition: bottom 0.3s ease;
    padding: 15px;
    box-sizing: border-box;
    z-index: 100;
  }

  .mod-card {
    background: #2f2f2f;
    border-radius: 10px;
    padding: 10px 15px;
    margin-bottom: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 16px;
    color: #fff;
  }

  .mod-card .status {
    padding: 2px 8px;
    border-radius: 5px;
    font-size: 14px;
    font-weight: bold;
  }

  .status.up {
    background-color: #28a745;
    color: white;
  }

  .status.outdated {
    background-color: #dc3545;
    color: white;
  }

  .drag-area {
    position: absolute;
    top: -30px;
    left: 50%;
    transform: translateX(-50%);
    width: 60px;
    height: 5px;
    background: #666;
    border-radius: 10px;
  }
</style>
</head>
<body>
<div class="center-info">
  <h1 id="status">Проверка Roblox...</h1>
  <div class="info" id="version">Версия: —</div>
  <div class="info" id="modType">Модификация: —</div>
</div>

<div id="overlay"></div>
<div id="modListContainer">
  <div class="drag-area"></div>
</div>

<script>
const overlay = document.getElementById('overlay');
const modListContainer = document.getElementById('modListContainer');
const dragArea = modListContainer.querySelector('.drag-area');
let startY = 0;
let currentBottom = 0;
let dragging = false;
const maxHeight = window.innerHeight * 0.8;

// Drag панели
dragArea.addEventListener('touchstart', e => {
  startY = e.touches[0].clientY;
  dragging = true;
  currentBottom = parseFloat(getComputedStyle(modListContainer).bottom) || -maxHeight;
  modListContainer.style.transition = 'none';
  overlay.style.display = 'block';
});

dragArea.addEventListener('touchmove', e => {
  if (!dragging) return;
  const touchY = e.touches[0].clientY;
  let diff = startY - touchY;
  let newBottom = Math.min(Math.max(currentBottom + diff, -maxHeight), 0);
  modListContainer.style.bottom = newBottom + 'px';
  e.preventDefault();
}, {passive: false});

dragArea.addEventListener('touchend', e => {
  if (!dragging) return;
  dragging = false;
  modListContainer.style.transition = 'bottom 0.3s ease';
  const bottomValue = parseFloat(modListContainer.style.bottom);
  if (bottomValue > -maxHeight + 20) {
    modListContainer.style.bottom = '0';
  } else {
    modListContainer.style.bottom = -maxHeight + 'px';
    overlay.style.display = 'none';
  }
});

// Закрытие по клику на overlay
overlay.addEventListener('click', () => {
  modListContainer.style.bottom = -maxHeight + 'px';
  overlay.style.display = 'none';
});

// Обновление статуса Roblox
function updateInfo(found, version, modType) {
  document.getElementById('status').textContent = found ? "✅ Roblox найден" : "❌ Roblox не найден";
  document.getElementById('version').textContent = "Версия: " + (version || "—");
  document.getElementById('modType').textContent = "Модификация: " + (modType || "—");
}

// Загрузка модификаций
function loadMods() {
  fetch('https://roblox-modss.vercel.app/backend/data.json')
    .then(res => res.json())
    .then(data => {
      modListContainer.innerHTML = '<div class="drag-area"></div>'; // сохраняем drag
      data.forEach(mod => {
        const card = document.createElement('div');
        card.className = 'mod-card';
        card.innerHTML = `
          <span>${mod.name} (v${mod.version})</span>
          <span class="status ${mod.upToDate ? 'up' : 'outdated'}">
            ${mod.upToDate ? 'Обновлено' : 'Устарело'}
          </span>
        `;
        modListContainer.appendChild(card);
      });
    })
    .catch(err => console.error('Ошибка загрузки модификаций:', err));
}

// Получение данных из AndroidBridge
if (window.AndroidBridge) {
  const modType = AndroidBridge.getUserModType?.() || '—';
  const robloxVersion = AndroidBridge.getRobloxVersion?.() || '—';
  const installed = AndroidBridge.isRobloxInstalled?.() || true;
  updateInfo(installed, robloxVersion, modType);
  loadMods();
}
</script>
</body>
</html>
